<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Global Temperature Visualization</title>
    <style>
        .tooltip {
            position: absolute;
            text-align: center;
            width: 120px;
            height: auto;
            padding: 5px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="chart"></div>
    <input type="range" min="1880" max="2023" value="2023" id="yearSlider">
    <p>Year: <span id="yearValue">2023</span></p>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        d3.csv("global_temperature_regions.csv").then(function(data) {
            data.forEach(d => {
                d.Year = +d.Year;
                d.Global = +d.Global;
                d.Region1 = +d.Region1;
                d.Region2 = +d.Region2;
                d.Region3 = +d.Region3;
            });

            const margin = {top: 20, right: 30, bottom: 30, left: 40},
                  width = 800 - margin.left - margin.right,
                  height = 400 - margin.top - margin.bottom;

            const svg = d3.select("#chart").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
              .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            const x = d3.scaleLinear()
                .domain(d3.extent(data, d => d.Year))
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([d3.min(data, d => d.Global), d3.max(data, d => d.Global)])
                .range([height, 0]);

            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

            svg.append("g")
                .call(d3.axisLeft(y));

            const line = svg.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 1.5)
                .attr("class", "line")
                .attr("d", d3.line()
                    .x(d => x(d.Year))
                    .y(d => y(d.Global))
                );

            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            svg.selectAll("circle")
                .data(data)
                .enter().append("circle")
                .attr("cx", d => x(d.Year))
                .attr("cy", d => y(d.Global))
                .attr("r", 3)
                .attr("fill", "steelblue")
                .on("mouseover", function(event, d) {
                    tooltip.transition().duration(200).style("opacity", .9);
                    tooltip.html("Year: " + d.Year + "<br/>" + "Avg Temp: " + d.Global.toFixed(2))
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    tooltip.transition().duration(500).style("opacity", 0);
                });

            const yearSlider = document.getElementById('yearSlider');
            const yearValue = document.getElementById('yearValue');

            yearSlider.addEventListener('input', function() {
                yearValue.innerHTML = this.value;
                const filteredData = data.filter(d => d.Year <= this.value);
                updateChart(filteredData);
            });

            function updateChart(filteredData) {
                // Update the y-domain based on the filtered data
                y.domain([d3.min(filteredData, d => d.Global), d3.max(filteredData, d => d.Global)]);

                // Update the y-axis
                svg.select(".y.axis")
                    .call(d3.axisLeft(y));

                // Update the line path
                line.datum(filteredData)
                    .attr("d", d3.line()
                        .x(d => x(d.Year))
                        .y(d => y(d.Global)));

                // Remove old circles
                svg.selectAll("circle").remove();

                // Add new circles
                svg.selectAll("circle")
                    .data(filteredData)
                    .enter().append("circle")
                    .attr("cx", d => x(d.Year))
                    .attr("cy", d => y(d.Global))
                    .attr("r", 3)
                    .attr("fill", "steelblue")
                    .on("mouseover", function(event, d) {
                        tooltip.transition().duration(200).style("opacity", .9);
                        tooltip.html("Year: " + d.Year + "<br/>" + "Avg Temp: " + d.Global.toFixed(2))
                            .style("left", (event.pageX + 5) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", function() {
                        tooltip.transition().duration(500).style("opacity", 0);
                    });
            }

            // Initial chart setup
            updateChart(data);
        });
    </script>
</body>
</html>
